"Content"
"    create procedure [usp_my_procedure_name]&#xD;&#xA;    as&#xD;&#xA;    begin&#xD;&#xA;    	set nocount on;&#xD;&#xA;    	declare @trancount int;&#xD;&#xA;    	set @trancount = @@trancount;&#xD;&#xA;    	begin try&#xD;&#xA;    		if @trancount = 0&#xD;&#xA;    			begin transaction&#xD;&#xA;    		else&#xD;&#xA;    			save transaction usp_my_procedure_name;&#xD;&#xA;    &#xD;&#xA;    		-- Do the actual work here&#xD;&#xA;    	&#xD;&#xA;    lbexit:&#xD;&#xA;    		if @trancount = 0	&#xD;&#xA;    			commit;&#xD;&#xA;    	end try&#xD;&#xA;    	begin catch&#xD;&#xA;    		declare @error int, @message varchar(4000), @xstate int;&#xD;&#xA;    		select @error = ERROR_NUMBER(), @message = ERROR_MESSAGE(), @xstate = XACT_STATE();&#xD;&#xA;    		if @xstate = -1&#xD;&#xA;    			rollback;&#xD;&#xA;    		if @xstate = 1 and @trancount = 0&#xD;&#xA;    			rollback&#xD;&#xA;    		if @xstate = 1 and @trancount > 0&#xD;&#xA;    			rollback transaction usp_my_procedure_name;&#xD;&#xA;    &#xD;&#xA;    		raiserror ('usp_my_procedure_name: %d: %s', 16, 1, @error, @message) ;&#xD;&#xA;    	end catch	&#xD;&#xA;    end"
