"Content"
"    drop table if exists employees;&#xD;&#xA;    create table employees&#xD;&#xA;    (&#xD;&#xA;    emp_id smallint unsigned not null auto_increment primary key,&#xD;&#xA;    name varchar(255) not null,&#xD;&#xA;    boss_id smallint unsigned null,&#xD;&#xA;    key (boss_id)&#xD;&#xA;    )&#xD;&#xA;    engine = innodb;&#xD;&#xA;    &#xD;&#xA;    insert into employees (name, boss_id) values&#xD;&#xA;    ('f00',null), &#xD;&#xA;      ('ali later',1), &#xD;&#xA;      ('megan fox',1), &#xD;&#xA;    	  ('jessica alba',3), &#xD;&#xA;    	  ('eva longoria',3), &#xD;&#xA;    		 ('keira knightley',5), &#xD;&#xA;    		    ('liv tyler',6), &#xD;&#xA;      		    ('sophie marceau',6);&#xD;&#xA;    &#xD;&#xA;    &#xD;&#xA;    drop procedure if exists employees_hier;&#xD;&#xA;    &#xD;&#xA;    delimiter #&#xD;&#xA;    &#xD;&#xA;    create procedure employees_hier&#xD;&#xA;    (&#xD;&#xA;    in p_emp_id smallint unsigned&#xD;&#xA;    )&#xD;&#xA;    begin&#xD;&#xA;    &#xD;&#xA;    declare v_done tinyint unsigned default(0);&#xD;&#xA;    declare v_dpth smallint unsigned default(0);&#xD;&#xA;    &#xD;&#xA;    create temporary table hier(&#xD;&#xA;     boss_id smallint unsigned, &#xD;&#xA;     emp_id smallint unsigned, &#xD;&#xA;     depth smallint unsigned&#xD;&#xA;    )engine = memory;&#xD;&#xA;    &#xD;&#xA;    insert into hier select boss_id, emp_id, v_dpth from employees where emp_id = p_emp_id;&#xD;&#xA;    &#xD;&#xA;    /* http://dev.mysql.com/doc/refman/5.0/en/temporary-table-problems.html */&#xD;&#xA;    &#xD;&#xA;    create temporary table emps engine=memory select * from hier;&#xD;&#xA;    &#xD;&#xA;    while not v_done do&#xD;&#xA;     &#xD;&#xA;    	if exists( select 1 from employees e inner join hier on e.boss_id = hier.emp_id and hier.depth = v_dpth) then&#xD;&#xA;    		&#xD;&#xA;    		insert into hier select e.boss_id, e.emp_id, v_dpth + 1 &#xD;&#xA;    			from employees e inner join emps on e.boss_id = emps.emp_id and emps.depth = v_dpth;&#xD;&#xA;    &#xD;&#xA;    		set v_dpth = v_dpth + 1;			&#xD;&#xA;    		&#xD;&#xA;    		truncate table emps;&#xD;&#xA;    		insert into emps select * from hier where depth = v_dpth;&#xD;&#xA;    		&#xD;&#xA;    	else&#xD;&#xA;    		set v_done = 1;&#xD;&#xA;    	end if;&#xD;&#xA;    	&#xD;&#xA;    end while;&#xD;&#xA;    &#xD;&#xA;    select &#xD;&#xA;     e.emp_id,&#xD;&#xA;     e.name as emp_name,&#xD;&#xA;     p.emp_id as boss_emp_id,&#xD;&#xA;     p.name as boss_name,&#xD;&#xA;     hier.depth&#xD;&#xA;    from &#xD;&#xA;     hier&#xD;&#xA;    inner join employees e on hier.emp_id = e.emp_id&#xD;&#xA;    left outer join employees p on hier.boss_id = p.emp_id;&#xD;&#xA;    		&#xD;&#xA;    drop temporary table if exists hier;&#xD;&#xA;    drop temporary table if exists emps;&#xD;&#xA;    &#xD;&#xA;    end #&#xD;&#xA;    &#xD;&#xA;    delimiter ;&#xD;&#xA;    &#xD;&#xA;    -- call this sproc from your php&#xD;&#xA;    &#xD;&#xA;    call employees_hier(1);"
