"Content"
"    Sub Mail_Selection_Range_Outlook_Body()&#xD;&#xA;    'For Tips see: http://www.rondebruin.nl/win/winmail/Outlook/tips.htm&#xD;&#xA;    'Don't forget to copy the function RangetoHTML in the module.&#xD;&#xA;    'Working in Excel 2000-2016&#xD;&#xA;        Dim rng As Range&#xD;&#xA;        Dim OutApp As Object&#xD;&#xA;        Dim OutMail As Object&#xD;&#xA;    &#xD;&#xA;        Set rng = Nothing&#xD;&#xA;        On Error Resume Next&#xD;&#xA;        'Only the visible cells in the selection&#xD;&#xA;        Set rng = Selection.SpecialCells(xlCellTypeVisible)&#xD;&#xA;        'You can also use a fixed range if you want&#xD;&#xA;        'Set rng = Sheets(""""YourSheet"""").Range(""""D4:D12"""").SpecialCells(xlCellTypeVisible)&#xD;&#xA;        On Error GoTo 0&#xD;&#xA;    &#xD;&#xA;        If rng Is Nothing Then&#xD;&#xA;            MsgBox """"The selection is not a range or the sheet is protected"""" & _&#xD;&#xA;                   vbNewLine & """"please correct and try again."""", vbOKOnly&#xD;&#xA;            Exit Sub&#xD;&#xA;        End If&#xD;&#xA;    &#xD;&#xA;        With Application&#xD;&#xA;            .EnableEvents = False&#xD;&#xA;            .ScreenUpdating = False&#xD;&#xA;        End With&#xD;&#xA;    &#xD;&#xA;        Set OutApp = CreateObject(""""Outlook.Application"""")&#xD;&#xA;        Set OutMail = OutApp.CreateItem(0)&#xD;&#xA;    &#xD;&#xA;        On Error Resume Next&#xD;&#xA;        With OutMail&#xD;&#xA;            .To = """"ron@debruin.nl""""&#xD;&#xA;            .CC = """"""""&#xD;&#xA;            .BCC = """"""""&#xD;&#xA;            .Subject = """"This is the Subject line""""&#xD;&#xA;            .HTMLBody = RangetoHTML(rng)&#xD;&#xA;            .Send   'or use .Display&#xD;&#xA;        End With&#xD;&#xA;        On Error GoTo 0&#xD;&#xA;    &#xD;&#xA;        With Application&#xD;&#xA;            .EnableEvents = True&#xD;&#xA;            .ScreenUpdating = True&#xD;&#xA;        End With&#xD;&#xA;    &#xD;&#xA;        Set OutMail = Nothing&#xD;&#xA;        Set OutApp = Nothing&#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    &#xD;&#xA;    Function RangetoHTML(rng As Range)&#xD;&#xA;    ' Changed by Ron de Bruin 28-Oct-2006&#xD;&#xA;    ' Working in Office 2000-2016&#xD;&#xA;        Dim fso As Object&#xD;&#xA;        Dim ts As Object&#xD;&#xA;        Dim TempFile As String&#xD;&#xA;        Dim TempWB As Workbook&#xD;&#xA;    &#xD;&#xA;        TempFile = Environ$(""""temp"""") & """"\"""" & Format(Now, """"dd-mm-yy h-mm-ss"""") & """".htm""""&#xD;&#xA;    &#xD;&#xA;        'Copy the range and create a new workbook to past the data in&#xD;&#xA;        rng.Copy&#xD;&#xA;        Set TempWB = Workbooks.Add(1)&#xD;&#xA;        With TempWB.Sheets(1)&#xD;&#xA;            .Cells(1).PasteSpecial Paste:=8&#xD;&#xA;            .Cells(1).PasteSpecial xlPasteValues, , False, False&#xD;&#xA;            .Cells(1).PasteSpecial xlPasteFormats, , False, False&#xD;&#xA;            .Cells(1).Select&#xD;&#xA;            Application.CutCopyMode = False&#xD;&#xA;            On Error Resume Next&#xD;&#xA;            .DrawingObjects.Visible = True&#xD;&#xA;            .DrawingObjects.Delete&#xD;&#xA;            On Error GoTo 0&#xD;&#xA;        End With&#xD;&#xA;    &#xD;&#xA;        'Publish the sheet to a htm file&#xD;&#xA;        With TempWB.PublishObjects.Add( _&#xD;&#xA;             SourceType:=xlSourceRange, _&#xD;&#xA;             Filename:=TempFile, _&#xD;&#xA;             Sheet:=TempWB.Sheets(1).Name, _&#xD;&#xA;             Source:=TempWB.Sheets(1).UsedRange.Address, _&#xD;&#xA;             HtmlType:=xlHtmlStatic)&#xD;&#xA;            .Publish (True)&#xD;&#xA;        End With&#xD;&#xA;    &#xD;&#xA;        'Read all data from the htm file into RangetoHTML&#xD;&#xA;        Set fso = CreateObject(""""Scripting.FileSystemObject"""")&#xD;&#xA;        Set ts = fso.GetFile(TempFile).OpenAsTextStream(1, -2)&#xD;&#xA;        RangetoHTML = ts.readall&#xD;&#xA;        ts.Close&#xD;&#xA;        RangetoHTML = Replace(RangetoHTML, """"align=center x:publishsource="""", _&#xD;&#xA;                              """"align=left x:publishsource="""")&#xD;&#xA;    &#xD;&#xA;        'Close TempWB&#xD;&#xA;        TempWB.Close savechanges:=False&#xD;&#xA;    &#xD;&#xA;        'Delete the htm file we used in this function&#xD;&#xA;        Kill TempFile&#xD;&#xA;    &#xD;&#xA;        Set ts = Nothing&#xD;&#xA;        Set fso = Nothing&#xD;&#xA;        Set TempWB = Nothing&#xD;&#xA;    End Function"
