"Content"
"    - (UIImage *)scaleAndRotateImage(UIImage *)image&#xD;&#xA;    {&#xD;&#xA;    	int kMaxResolution = 320; // Or whatever&#xD;&#xA;    	&#xD;&#xA;    	CGImageRef imgRef = image.CGImage;&#xD;&#xA;    	&#xD;&#xA;    	CGFloat width = CGImageGetWidth(imgRef);&#xD;&#xA;    	CGFloat height = CGImageGetHeight(imgRef);&#xD;&#xA;    	&#xD;&#xA;    	&#xD;&#xA;    	CGAffineTransform transform = CGAffineTransformIdentity;&#xD;&#xA;    	CGRect bounds = CGRectMake(0, 0, width, height);&#xD;&#xA;    	if (width > kMaxResolution || height > kMaxResolution) {&#xD;&#xA;    		CGFloat ratio = width/height;&#xD;&#xA;    		if (ratio > 1) {&#xD;&#xA;    			bounds.size.width = kMaxResolution;&#xD;&#xA;    			bounds.size.height = bounds.size.width / ratio;&#xD;&#xA;    		}&#xD;&#xA;    		else {&#xD;&#xA;    			bounds.size.height = kMaxResolution;&#xD;&#xA;    			bounds.size.width = bounds.size.height * ratio;&#xD;&#xA;    		}&#xD;&#xA;    	}&#xD;&#xA;    	&#xD;&#xA;    	CGFloat scaleRatio = bounds.size.width / width;&#xD;&#xA;    	CGSize imageSize = CGSizeMake(CGImageGetWidth(imgRef), CGImageGetHeight(imgRef));&#xD;&#xA;    	CGFloat boundHeight;&#xD;&#xA;    	UIImageOrientation orient = image.imageOrientation;&#xD;&#xA;    	switch(orient) {&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationUp: //EXIF = 1&#xD;&#xA;    			transform = CGAffineTransformIdentity;&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationUpMirrored: //EXIF = 2&#xD;&#xA;    			transform = CGAffineTransformMakeTranslation(imageSize.width, 0.0);&#xD;&#xA;    			transform = CGAffineTransformScale(transform, -1.0, 1.0);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationDown: //EXIF = 3&#xD;&#xA;    			transform = CGAffineTransformMakeTranslation(imageSize.width, imageSize.height);&#xD;&#xA;    			transform = CGAffineTransformRotate(transform, M_PI);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationDownMirrored: //EXIF = 4&#xD;&#xA;    			transform = CGAffineTransformMakeTranslation(0.0, imageSize.height);&#xD;&#xA;    			transform = CGAffineTransformScale(transform, 1.0, -1.0);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationLeftMirrored: //EXIF = 5&#xD;&#xA;    			boundHeight = bounds.size.height;&#xD;&#xA;    			bounds.size.height = bounds.size.width;&#xD;&#xA;    			bounds.size.width = boundHeight;&#xD;&#xA;    			transform = CGAffineTransformMakeTranslation(imageSize.height, imageSize.width);&#xD;&#xA;    			transform = CGAffineTransformScale(transform, -1.0, 1.0);&#xD;&#xA;    			transform = CGAffineTransformRotate(transform, 3.0 * M_PI / 2.0);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationLeft: //EXIF = 6&#xD;&#xA;    			boundHeight = bounds.size.height;&#xD;&#xA;    			bounds.size.height = bounds.size.width;&#xD;&#xA;    			bounds.size.width = boundHeight;&#xD;&#xA;    			transform = CGAffineTransformMakeTranslation(0.0, imageSize.width);&#xD;&#xA;    			transform = CGAffineTransformRotate(transform, 3.0 * M_PI / 2.0);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationRightMirrored: //EXIF = 7&#xD;&#xA;    			boundHeight = bounds.size.height;&#xD;&#xA;    			bounds.size.height = bounds.size.width;&#xD;&#xA;    			bounds.size.width = boundHeight;&#xD;&#xA;    			transform = CGAffineTransformMakeScale(-1.0, 1.0);&#xD;&#xA;    			transform = CGAffineTransformRotate(transform, M_PI / 2.0);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		case UIImageOrientationRight: //EXIF = 8&#xD;&#xA;    			boundHeight = bounds.size.height;&#xD;&#xA;    			bounds.size.height = bounds.size.width;&#xD;&#xA;    			bounds.size.width = boundHeight;&#xD;&#xA;    			transform = CGAffineTransformMakeTranslation(imageSize.height, 0.0);&#xD;&#xA;    			transform = CGAffineTransformRotate(transform, M_PI / 2.0);&#xD;&#xA;    			break;&#xD;&#xA;    			&#xD;&#xA;    		default:&#xD;&#xA;    			[NSException raise:NSInternalInconsistencyException format:@""""Invalid image orientation""""];&#xD;&#xA;    			&#xD;&#xA;    	}&#xD;&#xA;    	&#xD;&#xA;    	UIGraphicsBeginImageContext(bounds.size);&#xD;&#xA;    	&#xD;&#xA;    	CGContextRef context = UIGraphicsGetCurrentContext();&#xD;&#xA;    	&#xD;&#xA;    	if (orient == UIImageOrientationRight || orient == UIImageOrientationLeft) {&#xD;&#xA;    		CGContextScaleCTM(context, -scaleRatio, scaleRatio);&#xD;&#xA;    		CGContextTranslateCTM(context, -height, 0);&#xD;&#xA;    	}&#xD;&#xA;    	else {&#xD;&#xA;    		CGContextScaleCTM(context, scaleRatio, -scaleRatio);&#xD;&#xA;    		CGContextTranslateCTM(context, 0, -height);&#xD;&#xA;    	}&#xD;&#xA;    	&#xD;&#xA;    	CGContextConcatCTM(context, transform);&#xD;&#xA;    	&#xD;&#xA;    	CGContextDrawImage(UIGraphicsGetCurrentContext(), CGRectMake(0, 0, width, height), imgRef);&#xD;&#xA;    	UIImage *imageCopy = UIGraphicsGetImageFromCurrentImageContext();&#xD;&#xA;    	UIGraphicsEndImageContext();&#xD;&#xA;    	&#xD;&#xA;    	return imageCopy;&#xD;&#xA;    }"
