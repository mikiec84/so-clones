"Content"
"    'Samir Khan&#xD;&#xA;    'simulationconsultant@gmail.com&#xD;&#xA;    'The latest version of this spreadsheet can be downloaded from http://investexcel.net/multiple-stock-quote-downloader-for-excel/&#xD;&#xA;    'Please link to http://investexcel.net if you like this spreadsheet&#xD;&#xA;    &#xD;&#xA;    &#xD;&#xA;    Sub DownloadStockQuotes(ByVal stockTicker As String, ByVal StartDate As Date, ByVal EndDate As Date, ByVal DestinationCell As String, ByVal freq As String)&#xD;&#xA;    &#xD;&#xA;    Dim qurl As String&#xD;&#xA;    Dim StartMonth, StartDay, StartYear, EndMonth, EndDay, EndYear As String&#xD;&#xA;    &#xD;&#xA;    qurl = """"http://finance.google.com/finance/historical?q="""" & stockTicker&#xD;&#xA;    qurl = qurl & """"&startdate="""" & MonthName(Month(StartDate), True) & _&#xD;&#xA;           """"+"""" & Day(StartDate) & """"+"""" & Year(StartDate) & _&#xD;&#xA;           """"&enddate="""" & MonthName(Month(EndDate), True) & _&#xD;&#xA;           """"+"""" & Day(EndDate) & """"+"""" & Year(EndDate) & """"&output=csv""""&#xD;&#xA;           &#xD;&#xA;    On Error GoTo ErrorHandler:&#xD;&#xA;    &#xD;&#xA;    QueryQuote:&#xD;&#xA;    With ActiveSheet.QueryTables.Add(Connection:=""""URL;"""" & qurl, Destination:=Range(DestinationCell))&#xD;&#xA;        .BackgroundQuery = True&#xD;&#xA;        .TablesOnlyFromHTML = False&#xD;&#xA;        .Refresh BackgroundQuery:=False&#xD;&#xA;        .SaveData = True&#xD;&#xA;    End With&#xD;&#xA;    &#xD;&#xA;    ErrorHandler:&#xD;&#xA;    &#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    Sub DownloadData()&#xD;&#xA;    &#xD;&#xA;    Dim frequency As String&#xD;&#xA;    Dim numRows As Integer&#xD;&#xA;    Dim lastRow As Integer&#xD;&#xA;    Dim lastErrorRow As Integer&#xD;&#xA;    Dim lastSuccessRow As Integer&#xD;&#xA;    Dim stockTicker As String&#xD;&#xA;    Dim numStockErrors As Integer&#xD;&#xA;    Dim numStockSuccess As Integer&#xD;&#xA;    &#xD;&#xA;    numStockErrors = 0&#xD;&#xA;    numStockSuccess = 0&#xD;&#xA;    &#xD;&#xA;    Application.Calculation = xlCalculationManual&#xD;&#xA;    Application.ScreenUpdating = False&#xD;&#xA;    &#xD;&#xA;    lastErrorRow = ActiveSheet.Cells(Rows.Count, """"J"""").End(xlUp).Row&#xD;&#xA;    lastSuccessRow = ActiveSheet.Cells(Rows.Count, """"L"""").End(xlUp).Row&#xD;&#xA;    &#xD;&#xA;    ClearErrorList lastErrorRow&#xD;&#xA;    ClearSuccessList lastSuccessRow&#xD;&#xA;    &#xD;&#xA;    lastRow = ActiveSheet.Cells(Rows.Count, """"a"""").End(xlUp).Row&#xD;&#xA;    frequency = Worksheets(""""Parameters"""").Range(""""b7"""")&#xD;&#xA;    &#xD;&#xA;    'Delete all sheets apart from Parameters sheet&#xD;&#xA;    Dim ws As Worksheet&#xD;&#xA;    Application.DisplayAlerts = False&#xD;&#xA;    For Each ws In Worksheets&#xD;&#xA;        If ws.Name <> """"Parameters"""" And ws.Name <> """"About"""" Then ws.Delete&#xD;&#xA;    Next&#xD;&#xA;    &#xD;&#xA;    Application.DisplayAlerts = True&#xD;&#xA;    &#xD;&#xA;    'Loop through all tickers&#xD;&#xA;    For ticker = 12 To lastRow&#xD;&#xA;    &#xD;&#xA;        stockTicker = Worksheets(""""Parameters"""").Range(""""$a$"""" & ticker)&#xD;&#xA;    &#xD;&#xA;        If stockTicker = """""""" Then&#xD;&#xA;            GoTo NextIteration&#xD;&#xA;        End If&#xD;&#xA;    &#xD;&#xA;        Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;        &#xD;&#xA;        If InStr(stockTicker, """":"""") > 0 Then&#xD;&#xA;            ActiveSheet.Name = Replace(stockTicker, """":"""", """""""")&#xD;&#xA;        Else&#xD;&#xA;            ActiveSheet.Name = stockTicker&#xD;&#xA;        End If&#xD;&#xA;        &#xD;&#xA;        Cells(1, 1) = """"Stock Quotes for """" & stockTicker&#xD;&#xA;        Call DownloadStockQuotes(stockTicker, Worksheets(""""Parameters"""").Range(""""$b$5""""), Worksheets(""""Parameters"""").Range(""""$b$6""""), """"$a$2"""", frequency)&#xD;&#xA;        Columns(""""a:a"""").TextToColumns Destination:=Range(""""a1""""), DataType:=xlDelimited, _&#xD;&#xA;                                     TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=True, _&#xD;&#xA;                                     Semicolon:=False, Comma:=True, Space:=False, Other:=False, FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, 1), Array(6, 1), Array(7, 1))&#xD;&#xA;    &#xD;&#xA;        &#xD;&#xA;        If InStr(stockTicker, """":"""") > 0 Then&#xD;&#xA;            stockTicker = Replace(stockTicker, """":"""", """""""")&#xD;&#xA;        End If&#xD;&#xA;        &#xD;&#xA;        Sheets(stockTicker).Columns(""""A:G"""").ColumnWidth = 10&#xD;&#xA;    &#xD;&#xA;        lastRow = Sheets(stockTicker).UsedRange.Row - 2 + Sheets(stockTicker).UsedRange.Rows.Count&#xD;&#xA;    &#xD;&#xA;        If lastRow < 3 Then&#xD;&#xA;            Application.DisplayAlerts = False&#xD;&#xA;            Sheets(stockTicker).Delete&#xD;&#xA;            numStockErrors = numStockErrors + 1&#xD;&#xA;            ErrorList stockTicker, numStockErrors&#xD;&#xA;            GoTo NextIteration&#xD;&#xA;            Application.DisplayAlerts = True&#xD;&#xA;        Else&#xD;&#xA;            numStockSuccess = numStockSuccess + 1&#xD;&#xA;            If Left(stockTicker, 1) = """"^"""" Then&#xD;&#xA;                SuccessList Replace(stockTicker, """"^"""", """"""""), numStockSuccess&#xD;&#xA;            Else&#xD;&#xA;                SuccessList stockTicker, numStockSuccess&#xD;&#xA;            End If&#xD;&#xA;        End If&#xD;&#xA;    &#xD;&#xA;        Sheets(stockTicker).Sort.SortFields.Add Key:=Range(""""A3:A"""" & lastRow), SortOn:=xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal&#xD;&#xA;        With Sheets(stockTicker).Sort&#xD;&#xA;            .SetRange Range(""""A2:G"""" & lastRow)&#xD;&#xA;            .Header = xlYes&#xD;&#xA;            .MatchCase = False&#xD;&#xA;            .Orientation = xlTopToBottom&#xD;&#xA;            .SortMethod = xlPinYin&#xD;&#xA;            .Apply&#xD;&#xA;        End With&#xD;&#xA;    &#xD;&#xA;        Range(""""a3:a"""" & lastRow).NumberFormat = """"yyyy-mm-dd;@""""&#xD;&#xA;    &#xD;&#xA;        'Delete final blank row otherwise will get ,,,, at bottom of CSV&#xD;&#xA;        Sheets(stockTicker).Rows(lastRow + 1 & """":"""" & Sheets(stockTicker).Rows.Count).Delete&#xD;&#xA;    &#xD;&#xA;        'Remove initial ^ in ticker names from Sheets&#xD;&#xA;        If Left(stockTicker, 1) = """"^"""" Then&#xD;&#xA;            ActiveSheet.Name = Replace(stockTicker, """"^"""", """""""")&#xD;&#xA;        Else&#xD;&#xA;            ActiveSheet.Name = stockTicker&#xD;&#xA;        End If&#xD;&#xA;    &#xD;&#xA;        'Remove hyphens in ticker names from Sheet names, otherwise error in collation&#xD;&#xA;        If InStr(stockTicker, """"-"""") > 0 Then&#xD;&#xA;            ActiveSheet.Name = Replace(stockTicker, """"-"""", """""""")&#xD;&#xA;        End If&#xD;&#xA;    &#xD;&#xA;    &#xD;&#xA;    NextIteration:&#xD;&#xA;    Next ticker&#xD;&#xA;    &#xD;&#xA;    Application.DisplayAlerts = False&#xD;&#xA;    &#xD;&#xA;    If Sheets(""""Parameters"""").Shapes(""""WriteToCSVCheckBox"""").ControlFormat.Value = xlOn Then&#xD;&#xA;        On Error GoTo ErrorHandler:&#xD;&#xA;        Call CopyToCSV&#xD;&#xA;    End If&#xD;&#xA;    &#xD;&#xA;    If Sheets(""""Parameters"""").Shapes(""""CollateDataCheckBox"""").ControlFormat.Value = xlOn Then&#xD;&#xA;        On Error GoTo ErrorHandler:&#xD;&#xA;        Call CollateData&#xD;&#xA;    End If&#xD;&#xA;    &#xD;&#xA;    ErrorHandler:&#xD;&#xA;    &#xD;&#xA;    Worksheets(""""Parameters"""").Select&#xD;&#xA;    &#xD;&#xA;    Application.ScreenUpdating = True&#xD;&#xA;    Application.Calculation = xlCalculationAutomatic&#xD;&#xA;    &#xD;&#xA;    Worksheets(""""Parameters"""").Select&#xD;&#xA;    For Each C In ThisWorkbook.Connections&#xD;&#xA;        C.Delete&#xD;&#xA;    Next&#xD;&#xA;    &#xD;&#xA;    End Sub&#xD;&#xA;    Sub CollateData()&#xD;&#xA;    &#xD;&#xA;    Dim ws As Worksheet&#xD;&#xA;    Dim i As Integer, first As Integer&#xD;&#xA;    Dim maxRow As Integer&#xD;&#xA;    Dim maxTickerWS As Worksheet&#xD;&#xA;    &#xD;&#xA;    maxRow = 0&#xD;&#xA;    For Each ws In Worksheets&#xD;&#xA;        If ws.Name <> """"Parameters"""" Then&#xD;&#xA;            If ws.UsedRange.Rows.Count > maxRow Then&#xD;&#xA;                maxRow = ws.UsedRange.Rows.Count&#xD;&#xA;                Set maxTickerWS = ws&#xD;&#xA;            End If&#xD;&#xA;        End If&#xD;&#xA;    Next&#xD;&#xA;    &#xD;&#xA;    Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;    ActiveSheet.Name = """"Open""""&#xD;&#xA;    &#xD;&#xA;    Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;    ActiveSheet.Name = """"High""""&#xD;&#xA;    &#xD;&#xA;    Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;    ActiveSheet.Name = """"Low""""&#xD;&#xA;    &#xD;&#xA;    Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;    ActiveSheet.Name = """"Close""""&#xD;&#xA;    &#xD;&#xA;    Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;    ActiveSheet.Name = """"Volume""""&#xD;&#xA;    &#xD;&#xA;    Sheets.Add After:=Sheets(Sheets.Count)&#xD;&#xA;    ActiveSheet.Name = """"Adjusted Close""""&#xD;&#xA;    &#xD;&#xA;    i = 1&#xD;&#xA;    maxTickerWS.Range(""""A2"""", """"B"""" & maxRow).Copy Destination:=Sheets(""""Open"""").Cells(1, i)&#xD;&#xA;    Sheets(""""Open"""").Cells(1, i + 1) = maxTickerWS.Name&#xD;&#xA;    &#xD;&#xA;    maxTickerWS.Range(""""A2"""", """"a"""" & maxRow).Copy Destination:=Sheets(""""High"""").Cells(1, i)&#xD;&#xA;    maxTickerWS.Range(""""c2"""", """"c"""" & maxRow).Copy Destination:=Sheets(""""High"""").Cells(1, i + 1)&#xD;&#xA;    Sheets(""""High"""").Cells(1, i + 1) = maxTickerWS.Name&#xD;&#xA;    &#xD;&#xA;    maxTickerWS.Range(""""A2"""", """"a"""" & maxRow).Copy Destination:=Sheets(""""Low"""").Cells(1, i)&#xD;&#xA;    maxTickerWS.Range(""""d2"""", """"d"""" & maxRow).Copy Destination:=Sheets(""""Low"""").Cells(1, i + 1)&#xD;&#xA;    Sheets(""""Low"""").Cells(1, i + 1) = maxTickerWS.Name&#xD;&#xA;    &#xD;&#xA;    maxTickerWS.Range(""""A2"""", """"a"""" & maxRow).Copy Destination:=Sheets(""""Close"""").Cells(1, i)&#xD;&#xA;    maxTickerWS.Range(""""e2"""", """"e"""" & maxRow).Copy Destination:=Sheets(""""Close"""").Cells(1, i + 1)&#xD;&#xA;    Sheets(""""Close"""").Cells(1, i + 1) = maxTickerWS.Name&#xD;&#xA;    &#xD;&#xA;    maxTickerWS.Range(""""A2"""", """"a"""" & maxRow).Copy Destination:=Sheets(""""Volume"""").Cells(1, i)&#xD;&#xA;    maxTickerWS.Range(""""f2"""", """"f"""" & maxRow).Copy Destination:=Sheets(""""Volume"""").Cells(1, i + 1)&#xD;&#xA;    Sheets(""""Volume"""").Cells(1, i + 1) = maxTickerWS.Name&#xD;&#xA;    &#xD;&#xA;    maxTickerWS.Range(""""A2"""", """"a"""" & maxRow).Copy Destination:=Sheets(""""Adjusted Close"""").Cells(1, i)&#xD;&#xA;    maxTickerWS.Range(""""g2"""", """"g"""" & maxRow).Copy Destination:=Sheets(""""Adjusted Close"""").Cells(1, i + 1)&#xD;&#xA;    Sheets(""""Adjusted Close"""").Cells(1, i + 1) = maxTickerWS.Name&#xD;&#xA;    &#xD;&#xA;    i = i + 2&#xD;&#xA;    &#xD;&#xA;    For Each ws In Worksheets&#xD;&#xA;    &#xD;&#xA;        If ws.Name <> """"Parameters"""" And ws.Name <> """"About"""" And ws.Name <> maxTickerWS.Name And ws.Name <> """"Open"""" And ws.Name <> """"High"""" And ws.Name <> """"Low"""" And ws.Name <> """"Close"""" And ws.Name <> """"Volume"""" And ws.Name <> """"Adjusted Close"""" Then&#xD;&#xA;    &#xD;&#xA;            Sheets(""""Open"""").Cells(1, i) = ws.Name&#xD;&#xA;            Sheets(""""Open"""").Range(Sheets(""""Open"""").Cells(2, i), Sheets(""""Open"""").Cells(maxRow - 1, i)).Formula = _&#xD;&#xA;            """"=vlookup(A2,"""" & ws.Name & """"!A$2:G$"""" & maxRow & """",2,0)""""&#xD;&#xA;    &#xD;&#xA;            Sheets(""""High"""").Cells(1, i) = ws.Name&#xD;&#xA;            Sheets(""""High"""").Range(Sheets(""""High"""").Cells(2, i), Sheets(""""High"""").Cells(maxRow - 1, i)).Formula = _&#xD;&#xA;            """"=vlookup(A2,"""" & ws.Name & """"!A$2:G$"""" & maxRow & """",3,0)""""&#xD;&#xA;    &#xD;&#xA;            Sheets(""""Low"""").Cells(1, i) = ws.Name&#xD;&#xA;            Sheets(""""Low"""").Range(Sheets(""""Low"""").Cells(2, i), Sheets(""""Low"""").Cells(maxRow - 1, i)).Formula = _&#xD;&#xA;            """"=vlookup(A2,"""" & ws.Name & """"!A$2:G$"""" & maxRow & """",4,0)""""&#xD;&#xA;    &#xD;&#xA;            Sheets(""""Close"""").Cells(1, i) = ws.Name&#xD;&#xA;            Sheets(""""Close"""").Range(Sheets(""""Close"""").Cells(2, i), Sheets(""""Close"""").Cells(maxRow - 1, i)).Formula = _&#xD;&#xA;            """"=vlookup(A2,"""" & ws.Name & """"!A$2:G$"""" & maxRow & """",5,0)""""&#xD;&#xA;    &#xD;&#xA;            Sheets(""""Volume"""").Cells(1, i) = ws.Name&#xD;&#xA;            Sheets(""""Volume"""").Range(Sheets(""""Volume"""").Cells(2, i), Sheets(""""Volume"""").Cells(maxRow - 1, i)).Formula = _&#xD;&#xA;            """"=vlookup(A2,"""" & ws.Name & """"!A$2:G$"""" & maxRow & """",6,0)""""&#xD;&#xA;    &#xD;&#xA;            Sheets(""""Adjusted Close"""").Cells(1, i) = ws.Name&#xD;&#xA;            Sheets(""""Adjusted Close"""").Range(Sheets(""""Adjusted Close"""").Cells(2, i), Sheets(""""Adjusted Close"""").Cells(maxRow - 1, i)).Formula = _&#xD;&#xA;            """"=vlookup(A2,"""" & ws.Name & """"!A$2:G$"""" & maxRow & """",7,0)""""&#xD;&#xA;    &#xD;&#xA;            i = i + 1&#xD;&#xA;    &#xD;&#xA;        End If&#xD;&#xA;    Next&#xD;&#xA;    &#xD;&#xA;    On Error Resume Next&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Open"""").UsedRange.SpecialCells(xlFormulas, xlErrors).Clear&#xD;&#xA;    Sheets(""""Close"""").UsedRange.SpecialCells(xlFormulas, xlErrors).Clear&#xD;&#xA;    Sheets(""""High"""").UsedRange.SpecialCells(xlFormulas, xlErrors).Clear&#xD;&#xA;    Sheets(""""Low"""").UsedRange.SpecialCells(xlFormulas, xlErrors).Clear&#xD;&#xA;    Sheets(""""Volume"""").UsedRange.SpecialCells(xlFormulas, xlErrors).Clear&#xD;&#xA;    Sheets(""""Adjusted Close"""").UsedRange.SpecialCells(xlFormulas, xlErrors).Clear&#xD;&#xA;    &#xD;&#xA;    On Error GoTo 0&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Open"""").Columns(""""A:A"""").EntireColumn.AutoFit&#xD;&#xA;    Sheets(""""High"""").Columns(""""A:A"""").EntireColumn.AutoFit&#xD;&#xA;    Sheets(""""Low"""").Columns(""""A:A"""").EntireColumn.AutoFit&#xD;&#xA;    Sheets(""""Close"""").Columns(""""A:A"""").EntireColumn.AutoFit&#xD;&#xA;    Sheets(""""Volume"""").Columns(""""A:A"""").EntireColumn.AutoFit&#xD;&#xA;    Sheets(""""Adjusted Close"""").Columns(""""A:A"""").EntireColumn.AutoFit&#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    Sub SuccessList(ByVal stockTicker As String, ByVal numStockSuccess As Integer)&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L"""" & 10 + numStockSuccess) = stockTicker&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlDiagonalDown).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlDiagonalUp).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeLeft).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeTop).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeBottom).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeRight).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlInsideVertical).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlInsideHorizontal).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlDiagonalDown).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlDiagonalUp).LineStyle = xlNone&#xD;&#xA;    &#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeLeft)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeTop)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeBottom)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlEdgeRight)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlInsideVertical).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Borders(xlInsideHorizontal).LineStyle = xlNone&#xD;&#xA;    &#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""L10:L"""" & 10 + numStockSuccess).Interior&#xD;&#xA;        .PatternColorIndex = xlAutomatic&#xD;&#xA;        .ThemeColor = xlThemeColorAccent2&#xD;&#xA;        .TintAndShade = 0.799981688894314&#xD;&#xA;        .PatternTintAndShade = 0&#xD;&#xA;    End With&#xD;&#xA;    &#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    Sub ErrorList(ByVal stockTicker As String, ByVal numStockErrors As Integer)&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J"""" & 10 + numStockErrors) = stockTicker&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlDiagonalDown).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlDiagonalUp).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeLeft).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeTop).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeBottom).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeRight).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlInsideVertical).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlInsideHorizontal).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlDiagonalDown).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlDiagonalUp).LineStyle = xlNone&#xD;&#xA;    &#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeLeft)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeTop)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeBottom)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlEdgeRight)&#xD;&#xA;        .LineStyle = xlContinuous&#xD;&#xA;        .ColorIndex = 0&#xD;&#xA;        .TintAndShade = 0&#xD;&#xA;        .Weight = xlMedium&#xD;&#xA;    End With&#xD;&#xA;    &#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlInsideVertical).LineStyle = xlNone&#xD;&#xA;    Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Borders(xlInsideHorizontal).LineStyle = xlNone&#xD;&#xA;    &#xD;&#xA;    With Sheets(""""Parameters"""").Range(""""J10:J"""" & 10 + numStockErrors).Interior&#xD;&#xA;        .PatternColorIndex = xlAutomatic&#xD;&#xA;        .ThemeColor = xlThemeColorAccent2&#xD;&#xA;        .TintAndShade = 0.799981688894314&#xD;&#xA;        .PatternTintAndShade = 0&#xD;&#xA;    End With&#xD;&#xA;    &#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    Sub ClearErrorList(ByVal lastErrorRow As Integer)&#xD;&#xA;    If lastErrorRow > 10 Then&#xD;&#xA;        Worksheets(""""Parameters"""").Range(""""J11:J"""" & lastErrorRow).Clear&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""J10"""").Borders(xlEdgeLeft)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""J10"""").Borders(xlEdgeTop)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""J10"""").Borders(xlEdgeBottom)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""J10"""").Borders(xlEdgeRight)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;    End If&#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    Sub ClearSuccessList(ByVal lastSuccessRow As Integer)&#xD;&#xA;    If lastSuccessRow > 10 Then&#xD;&#xA;        Worksheets(""""Parameters"""").Range(""""L11:L"""" & lastSuccessRow).Clear&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""L10"""").Borders(xlEdgeLeft)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""L10"""").Borders(xlEdgeTop)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""L10"""").Borders(xlEdgeBottom)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;        With Sheets(""""Parameters"""").Range(""""L10"""").Borders(xlEdgeRight)&#xD;&#xA;            .LineStyle = xlContinuous&#xD;&#xA;            .ColorIndex = 0&#xD;&#xA;            .TintAndShade = 0&#xD;&#xA;            .Weight = xlMedium&#xD;&#xA;        End With&#xD;&#xA;    End If&#xD;&#xA;    End Sub&#xD;&#xA;    &#xD;&#xA;    &#xD;&#xA;    Sub CopyToCSV()&#xD;&#xA;    &#xD;&#xA;    Dim MyPath As String&#xD;&#xA;    Dim MyFileName As String&#xD;&#xA;    &#xD;&#xA;    dateFrom = Worksheets(""""Parameters"""").Range(""""$b$5"""")&#xD;&#xA;    dateTo = Worksheets(""""Parameters"""").Range(""""$b$6"""")&#xD;&#xA;    frequency = Worksheets(""""Parameters"""").Range(""""$b$7"""")&#xD;&#xA;    MyPath = Worksheets(""""Parameters"""").Range(""""$b$8"""")&#xD;&#xA;    &#xD;&#xA;    For Each ws In Worksheets&#xD;&#xA;        If ws.Name <> """"Parameters"""" And ws.Name <> """"About"""" Then&#xD;&#xA;            ticker = ws.Name&#xD;&#xA;            MyFileName = ticker & """" """" & Format(dateFrom, """"dd-mm-yyyy"""") & """" - """" & Format(dateTo, """"dd-mm-yyyy"""") & """" """" & frequency&#xD;&#xA;            If Not Right(MyPath, 1) = """"\"""" Then MyPath = MyPath & """"\""""&#xD;&#xA;            If Not Right(MyFileName, 4) = """".csv"""" Then MyFileName = MyFileName & """".csv""""&#xD;&#xA;            Sheets(ticker).Copy&#xD;&#xA;            With ActiveWorkbook&#xD;&#xA;                .SaveAs Filename:= _&#xD;&#xA;                        MyPath & MyFileName, _&#xD;&#xA;                        FileFormat:=xlCSV, _&#xD;&#xA;                        CreateBackup:=False&#xD;&#xA;                .Close False&#xD;&#xA;            End With&#xD;&#xA;        End If&#xD;&#xA;    Next&#xD;&#xA;    &#xD;&#xA;    End Sub"
